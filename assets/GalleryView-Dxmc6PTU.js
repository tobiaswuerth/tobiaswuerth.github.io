import{s as O,a as j}from"./index-BZJ-7Nqn.js";import{d as G,u as F,a as R,o as W,b as D,r as u,w as H,c as x,e as f,f as h,g as C,h as U,i,j as S,s as Z,t as m,n as J,k as K}from"./index-4r0eha8W.js";import{s as Q}from"./index-Bez026_g.js";const X={class:"gallery-container"},Y={class:"controls","aria-label":"Layout controls"},ee={for:"cols"},te={class:"column-display"},oe={key:0,class:"loading-container"},se="/gallery/images.txt",y="calc((100cqw - (var(--cols) - 1) * var(--gap)) / var(--cols))",ie=G({__name:"GalleryView",setup(ae){const{t:v}=F(),{setTitle:E,setIcon:M,reset:T}=R();W(()=>{E("gallery.title"),M("pi pi-images"),B()}),D(()=>{T()});const I=[128,256,512,1024,1536,2048],c=u(!0),d=u(""),l=u(4),g=u(10),w=localStorage.getItem("gridColumns");if(w){const e=parseInt(w,10);e>=1&&e<=13&&(l.value=e)}else l.value=Math.floor(b());H(l,e=>{const o=document.querySelector("#grid");o&&(o.style.setProperty("--cols",e.toString()),localStorage.setItem("gridColumns",e.toString()))},{immediate:!0});const k=()=>new Promise(e=>requestAnimationFrame(e)),V=e=>new Promise(o=>setTimeout(o,e));function q(e,o){let t;return(...s)=>{clearTimeout(t),t=setTimeout(()=>e(...s),o)}}function b(){let e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return e=Math.min(e,1800),e/384}function _(){let e=Math.floor(b()*3);return e=Math.min(e,13),e=Math.max(e,5),e}function p(e,o){return I.map(t=>`/gallery/${e}/${e}-${t}.${o} ${t}w`).join(", ")}async function z(e,o=1e4){try{const t=V(o).then(()=>{const s=new Error("decode() timeout");throw s.name="TimeoutError",s});await Promise.race([e.decode(),t])}catch{}}function P(e){const o=document.createElement("figure");o.className="gallery-card";const t=document.createElement("a");t.href=`/gallery/${e}/${e}-2048.jpg`,t.target="_blank",t.rel="noopener",t.setAttribute("aria-label",`View high resolution image: ${e}`);const s=document.createElement("picture"),n=document.createElement("source");n.type="image/avif",n.sizes=y,n.dataset.srcset=p(e,"avif");const r=document.createElement("source");r.type="image/webp",r.sizes=y,r.dataset.srcset=p(e,"webp");const a=document.createElement("img");return a.alt=`Photo: ${e}`,a.decoding="async",a.loading="lazy",a.fetchPriority="low",a.className="img-lqip gallery-image",a.sizes=y,a.src=`/gallery/${e}/${e}-lqip.jpg`,a.dataset.srcset=p(e,"jpg"),a.dataset.name=e,s.append(n,r,a),t.appendChild(s),o.appendChild(t),o.style.contentVisibility="auto",{figure:o,img:a}}async function $(e){if(e.dataset.hydrated==="1")return;const t=e.parentElement.querySelectorAll("source");e.fetchPriority="high",e.loading="eager",t.forEach(s=>{s.dataset.srcset&&!s.srcset&&(s.srcset=s.dataset.srcset)}),e.dataset.srcset&&!e.srcset&&(e.srcset=e.dataset.srcset),await k(),await z(e),e.classList.remove("img-lqip"),e.classList.add("img-loaded"),e.dataset.hydrated="1"}function L(){if(!("IntersectionObserver"in window))return null;const e=new IntersectionObserver(o=>{for(const t of o){const s=t.target;t.isIntersecting&&($(s).catch(()=>{s.classList.remove("img-lqip"),s.classList.add("img-error"),s.alt=`Failed to load image: ${s.dataset.name||""}`}),e.unobserve(s))}},{rootMargin:"200px 0px",threshold:.01});return e}function A(){if("ResizeObserver"in window){const e=q(()=>{const t=_();g.value=t,l.value>t&&(l.value=t)},250);new ResizeObserver(e).observe(document.body),g.value=_()}}async function N(){const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const t=await fetch(se,{cache:"no-store",signal:e.signal});if(!t.ok)throw new Error(`HTTP ${t.status}: ${t.statusText}`);const n=(await t.text()).split(/\r?\n/).map(r=>r.trim()).filter(Boolean).filter(r=>/^[a-zA-Z0-9_-]+$/.test(r));if(!n.length)throw new Error("No valid images found");return n}finally{clearTimeout(o)}}async function B(){const e=document.querySelector("#grid");if(!e){console.error("Grid element not found"),d.value=v("gallery.gridNotFound"),c.value=!1;return}try{const o=await N(),t=document.createDocumentFragment(),s=L();for(const n of o){const{figure:r,img:a}=P(n);t.appendChild(r),s?s.observe(a):$(a).catch(()=>{})}e.appendChild(t),c.value=!1,A(),document.addEventListener("visibilitychange",()=>{e.querySelectorAll("img").forEach(r=>{const a=r;a.fetchPriority=document.hidden?"low":a.dataset.hydrated==="1"?"auto":"high"})}),console.log(`Gallery initialized with ${o.length} images`)}catch(o){console.error("Gallery initialization failed:",o);const t=o;d.value=v("gallery.error",{error:t.message}),c.value=!1}}return(e,o)=>{const t=Q,s=Z,n=O,r=j;return f(),x("div",X,[h(s,null,{content:S(()=>[i("div",Y,[i("label",ee,m(e.$t("gallery.columns")),1),h(t,{id:"cols",modelValue:l.value,"onUpdate:modelValue":o[0]||(o[0]=a=>l.value=a),min:1,max:g.value,step:1,class:"column-slider"},null,8,["modelValue","max"]),i("span",te,m(l.value),1)])]),_:1}),c.value?(f(),x("div",oe,[h(n,{style:{width:"50px",height:"50px"},strokeWidth:"8"}),i("h4",null,m(e.$t("gallery.loading")),1)])):C("",!0),d.value?(f(),U(r,{key:1,severity:"error",closable:!1},{default:S(()=>[K(m(d.value),1)]),_:1})):C("",!0),i("div",{id:"grid",class:"gallery-grid",style:J({"--cols":l.value}),"aria-live":"polite"},null,4)])}}});export{ie as default};
