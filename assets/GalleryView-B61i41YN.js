import{d as k,r as d,c as M,o as z,a as V,b as h,e as p,f as i,_ as O,u as A,g as F,h as W,i as S,w as D,s as H,F as b,j as x,n as C,t as N,k as U,l as R}from"./main-Cbn4rnod.js";import{s as Z}from"./index-5X-iVzb2.js";const J={class:"gallery-card"},K=["href"],Q=["data-srcset","sizes"],X=["data-srcset","sizes"],Y=["data-srcset","sizes","src","alt"],ee=k({__name:"GalleryImage",props:{imageName:{},cols:{}},setup(y){const t=y,e=d();let n=null;function g(r,m){return[128,256,512,1024,1536,2048].map(_=>`/gallery/${r}/${r}-${_}.${m} ${_}w`).join(", ")}const u=M(()=>`calc((100vw - 32px - (${t.cols-1} * 8px)) / ${t.cols})`);async function v(){try{if(!e.value){console.error("No image element to hydrate");return}if(e.value.dataset.hydrated==="1"){console.warn("Image already hydrated",e.value.src);return}e.value.dataset.hydrated="1",e.value.fetchPriority="high",e.value.loading="eager",e.value.parentElement.querySelectorAll("source").forEach(m=>m.srcset=m.dataset.srcset),e.value.srcset=e.value.dataset.srcset,e.value.decode().catch(console.warn).finally(()=>{e.value.classList.remove("img-lqip")})}catch(r){console.error("Error hydrating image",r)}}function w(){if(!("IntersectionObserver"in window)){console.warn("IntersectionObserver not supported"),v().catch(console.error);return}n=new IntersectionObserver(r=>{if(!e.value){console.error("No image element to observe");return}if(r.length===0){console.warn("No intersection entries");return}r[0].isIntersecting&&v().catch(()=>{console.warn("Failed to hydrate image",e.value.src),e.value.classList.remove("img-lqip"),e.value.alt=`Failed to load image: ${e.value.dataset.name||""}`}).finally(f)},{rootMargin:"200px 0px",threshold:.01}),n.observe(e.value)}function f(){n&&(n.disconnect(),n=null)}return z(()=>{w()}),V(()=>{f()}),(r,m)=>(p(),h("figure",J,[i("a",{href:`/gallery/${t.imageName}/${t.imageName}-2048.jpg`,target:"_blank",rel:"noopener"},[i("picture",null,[i("source",{type:"image/avif","data-srcset":g(t.imageName,"avif"),sizes:u.value},null,8,Q),i("source",{type:"image/webp","data-srcset":g(t.imageName,"webp"),sizes:u.value},null,8,X),i("img",{ref_key:"eImg",ref:e,type:"image/jpeg","data-srcset":g(t.imageName,"jpg"),sizes:u.value,src:`/gallery/${t.imageName}/${t.imageName}-lqip.jpg`,loading:"lazy",decoding:"async",fetchpriority:"low",alt:t.imageName,class:"img-lqip gallery-image"},null,8,Y)])],8,K)]))}}),ae=O(ee,[["__scopeId","data-v-9cc6922c"]]);function te(y,t){let e;return(...n)=>{clearTimeout(e),e=setTimeout(()=>y(...n),t)}}const se={class:"gallery-container"},oe={class:"columns-controls","aria-label":"Layout controls"},le={for:"cols"},ne={class:"slider-container"},re={class:"slider-ticks"},ce={class:"column-display"},ie=k({__name:"GalleryView",setup(y){const t=d(3),e=d(5),n=d([]),g=d([]),u=d(30),v=d(30),w=M(()=>{const o=e.value*10,l=[];for(let a=2;a<=e.value-1;a++){const P=(a*10-10)/(o-10)*100;l.push(P)}return l}),{enableSearch:f,setSearchResultsCallback:r,disableSearch:m}=A(),{setTitle:$,setIcon:_,resetAppBar:B}=F(),{showLoading:j,closePopup:q}=W();z(()=>{$("gallery.title"),_("pi pi-images"),f(),r(async s=>{if(s.length===0){n.value=g.value;return}n.value=s.map(o=>o.imageName)}),L(),G()}),V(()=>{B(),m()});function I(s){v.value=s*10,u.value=s*10,t.value=s,document.querySelector("#grid").style.setProperty("--cols",s.toString()),localStorage.setItem("gridColumns",s.toString())}const T=te(E,200);function E(...s){const o=s[0],l=o>v.value?1:-1;let a=Math.round(o/10);a===t.value&&(a+=l),a=Math.max(1,Math.min(e.value,a)),I(a)}function G(){const o=Math.min(Math.max(document.documentElement.clientWidth,window.innerWidth),1800)/384,l=Math.max(Math.min(Math.floor(o*3),13),5);e.value=l;let a;const c=localStorage.getItem("gridColumns");c?(a=parseInt(c),a>l&&(a=l)):a=Math.floor(o),I(a)}async function L(){j("gallery.loading");const l=(await(await fetch("/gallery/images.txt",{cache:"no-store"})).text()).split(/\r?\n/).map(a=>a.trim()).filter(Boolean).filter(a=>/^[a-zA-Z0-9_-]+$/.test(a));g.value=[...l],n.value=[...l],q()}return(s,o)=>{const l=Z,a=H;return p(),h("div",se,[S(a,{class:"gallery-controls"},{content:D(()=>[i("div",oe,[i("label",le,N(s.$t("gallery.columns")),1),i("div",ne,[S(l,{id:"cols",modelValue:u.value,"onUpdate:modelValue":[o[0]||(o[0]=c=>u.value=c),U(T)],min:10,max:e.value*10,step:1,class:"column-slider"},null,8,["modelValue","max","onUpdate:modelValue"]),i("div",re,[(p(!0),h(b,null,x(w.value,c=>(p(),h("div",{key:c,class:"tick",style:C({left:c+"%"})},null,4))),128))])]),i("span",ce,N(t.value),1)])]),_:1}),i("div",{id:"grid",class:"gallery-grid",style:C({"--cols":t.value}),"aria-live":"polite"},[(p(!0),h(b,null,x(n.value,c=>(p(),R(ae,{key:c,"image-name":c,cols:t.value},null,8,["image-name","cols"]))),128))],4)])}}}),de=O(ie,[["__scopeId","data-v-6b693919"]]);export{de as default};
