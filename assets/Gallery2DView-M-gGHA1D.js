import{B as Re,b as q,e as k,m as ae,f as B,p as Te,d as fe,r as P,o as ye,a as he,F as Ae,l as re,q as oe,i as ve,t as le,v as ue,x as _e,w as Ce,T as be,y as Oe,_ as ge,g as Pe,u as Me,h as ke,z as ce}from"./main-D7NUvrPd.js";var De=`
    .p-progressspinner {
        position: relative;
        margin: 0 auto;
        width: 100px;
        height: 100px;
        display: inline-block;
    }

    .p-progressspinner::before {
        content: '';
        display: block;
        padding-top: 100%;
    }

    .p-progressspinner-spin {
        height: 100%;
        transform-origin: center center;
        width: 100%;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        animation: p-progressspinner-rotate 2s linear infinite;
    }

    .p-progressspinner-circle {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: 0;
        stroke: dt('progressspinner.colorOne');
        animation:
            p-progressspinner-dash 1.5s ease-in-out infinite,
            p-progressspinner-color 6s ease-in-out infinite;
        stroke-linecap: round;
    }

    @keyframes p-progressspinner-rotate {
        100% {
            transform: rotate(360deg);
        }
    }
    @keyframes p-progressspinner-dash {
        0% {
            stroke-dasharray: 1, 200;
            stroke-dashoffset: 0;
        }
        50% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -35px;
        }
        100% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -124px;
        }
    }
    @keyframes p-progressspinner-color {
        100%,
        0% {
            stroke: dt('progressspinner.color.one');
        }
        40% {
            stroke: dt('progressspinner.color.two');
        }
        66% {
            stroke: dt('progressspinner.color.three');
        }
        80%,
        90% {
            stroke: dt('progressspinner.color.four');
        }
    }
`,Le={root:"p-progressspinner",spin:"p-progressspinner-spin",circle:"p-progressspinner-circle"},Ne=Re.extend({name:"progressspinner",style:De,classes:Le}),Ge={name:"BaseProgressSpinner",extends:Te,props:{strokeWidth:{type:String,default:"2"},fill:{type:String,default:"none"},animationDuration:{type:String,default:"2s"}},style:Ne,provide:function(){return{$pcProgressSpinner:this,$parentInstance:this}}},me={name:"ProgressSpinner",extends:Ge,inheritAttrs:!1,computed:{svgStyle:function(){return{"animation-duration":this.animationDuration}}}},He=["fill","stroke-width"];function Ve(I,u,D,w,E,A){return k(),q("div",ae({class:I.cx("root"),role:"progressbar"},I.ptmi("root")),[(k(),q("svg",ae({class:I.cx("spin"),viewBox:"25 25 50 50",style:A.svgStyle},I.ptm("spin")),[B("circle",ae({class:I.cx("circle"),cx:"50",cy:"50",r:"20",fill:I.fill,"stroke-width":I.strokeWidth,strokeMiterlimit:"10"},I.ptm("circle")),null,16,He)],16))],16)}me.render=Ve;const Xe="/2d-tutorial.webm",Be="/2d-tutorial-alt.png",$e={key:1},de=1500,pe="gallery2d.tutorial_viewed",ze=fe({__name:"Gallery2DTutorial",props:{registerOnReady:{type:Function}},setup(I){const u=I,D=P(null),w=P(null),E=P(null),A=P(!0),L=P(!1);let l=null,Z=null,Y=null,$=null,O=null,y=null;const r=P(!1),N=P(!1);let h=!1;function _(){try{return!!localStorage.getItem(pe)}catch{return!1}}function M(){try{localStorage.setItem(pe,"1")}catch{}}function J(f,v,x,g){if(!f||!v||!x||!g){console.warn("Tutorial not starting: missing required parameters"),console.debug({viewport_:f,config_:v,worldWidth_:x,drawGrid_:g});return}console.log("2D tutorial ready"),l=f,Z=v,Y=x,$=g,r.value=!0,O={x:l.x,y:l.y,scale:l.scale.x},y=l.eventMode,_()||R()}function G(){console.warn("Tutorial video: error loading/playing source"),A.value=!0}function z(){A.value=!1}function C(){return new Promise(f=>{if(w.value&&w.value.readyState>=2){f();return}w.value?w.value.addEventListener("canplay",()=>f(),{once:!0}):f()})}function Q(){return new Promise(f=>{if(E.value&&E.value.complete){f();return}E.value?E.value.addEventListener("load",()=>f(),{once:!0}):f()})}async function R(){if(!D.value||!w.value){console.warn("Tutorial not starting: tutorial container or tutorial video not initialized"),console.debug({tutorialContainer:D.value,tutorialVideo:w.value});return}if(h=!1,N.value=!0,l.eventMode="none",l.plugins.pause("decelerate"),l.plugins.pause("drag"),l.plugins.pause("pinch"),l.plugins.pause("wheel"),L.value=!1,A.value?E.value&&(E.value.src="/2d-tutorial-alt.png",await Q(),L.value=!0):(await C(),L.value=!0),!A.value)try{w.value.currentTime=0,await w.value.play()}catch(f){console.warn("Tutorial video cannot be played:",f),A.value=!0,E.value&&(E.value.src="/2d-tutorial-alt.png",await Q(),L.value=!0)}ee(),await te(!1),!h&&(await ne(!1),!h&&(await ne(!0),!h&&(await te(!0),!h&&(M(),F()))))}function K(){h=!0,F(),M()}function ee(){if(O&&l)try{l.x=O.x,l.y=O.y,l.scale.set(O.scale)}catch{}$()}function F(){if(!D.value||!w.value){console.warn("Tutorial not stopping: tutorial container or tutorial video not initialized");return}N.value=!1,w.value.pause(),ee(),y!==null&&l?l.eventMode=y:l.eventMode="static",l.plugins.resume("decelerate"),l.plugins.resume("drag"),l.plugins.resume("pinch"),l.plugins.resume("wheel")}function te(f=!1){return new Promise(v=>{const x=l.scale.x,g=f?x/10:x*10,S=f?Math.max(Z.VIEWPORT.MIN_SCALE,g):Math.min(Z.VIEWPORT.MAX_SCALE,g),b={x:window.innerWidth/2,y:window.innerHeight/2},U=l.toWorld(b.x,b.y),H=S-x;if(Math.abs(H)<1e-6){v();return}const W=de/1e3,V=Math.abs(H)/W;let e=performance.now();const o=t=>{if(h){v();return}const n=(t-e)/1e3;e=t;const a=Math.sign(H);let d=l.scale.x+a*V*n;(a>0&&d>=S||a<0&&d<=S)&&(d=S),l.scale.set(d);const c=l.toScreen(U.x,U.y);if(l.x+=b.x-c.x,l.y+=b.y-c.y,$(),d===S){v();return}requestAnimationFrame(o)};requestAnimationFrame(o)})}function ne(f=!1){return new Promise(v=>{const x=Y/4,g=l.x,S=f?g-x:g+x,b=S-g;if(Math.abs(b)<1e-6){v();return}const U=de/1e3,H=Math.abs(b)/U;let W=performance.now();const V=e=>{if(h){v();return}const o=(e-W)/1e3;W=e;const t=Math.sign(b);let n=l.x+t*H*o;if((t>0&&n>=S||t<0&&n<=S)&&(n=S),l.x=n,$(),n===S){v();return}requestAnimationFrame(V)};requestAnimationFrame(V)})}return ye(()=>{if(!("ontouchstart"in window)&&navigator.maxTouchPoints<1){console.log("Skipping 2D tutorial: no touch support detected");return}u.registerOnReady(J)}),he(()=>{h=!0,F()}),(f,v)=>{const x=me,g=_e;return k(),q(Ae,null,[B("div",{ref_key:"tutorialContainer",ref:D,class:ue(["tutorial",{hide:!N.value}])},[L.value?oe("",!0):(k(),re(x,{key:0,class:"spinner"})),B("h2",null,le(f.$t("gallery2d.tutorial")),1),B("video",{ref_key:"tutorialVideo",ref:w,muted:"",preload:"metadata",onError:G,onCanplay:z,class:ue({hide:A.value})},[...v[0]||(v[0]=[B("source",{src:Xe,type:"video/webm"},null,-1)])],34),A.value?(k(),q("div",$e,[B("img",{ref_key:"tutorialImage",ref:E,src:Be,alt:"2D Tutorial"},null,512)])):oe("",!0),ve(g,{class:"tutorial-skip",onClick:K,severity:"contrast",rounded:""},{default:Ce(()=>[Oe(le(f.$t("gallery2d.tutorial_skip")),1)]),_:1})],2),(k(),re(be,{to:"body"},[r.value&&!N.value?(k(),re(g,{key:0,icon:"pi pi-question-circle",onClick:R,raised:"",text:"",rounded:"",severity:"primary",variant:"outlined","aria-label":f.$t("gallery2d.tutorial"),class:"tutorial-button"},null,8,["aria-label"])):oe("",!0)]))],64)}}}),Fe=ge(ze,[["__scopeId","data-v-40f7373e"]]),Ue={class:"gallery-2d-container"},We=fe({__name:"Gallery2DView",setup(I){const u={COORDS_URL:"/gallery2d.json",BASE_SPRITE_SIZE:128,BACKGROUND:{COLOR_LIGHT:15132379,COLOR_DARK:1710618},GRID:{COLOR_LIGHT:13290186,COLOR_DARK:3355443,ALPHA_MAJOR:.5,ALPHA_MINOR:.25,MAJOR_LINE_SPACING:100,MINOR_LINE_SPACING:20},INTERACTION:{DRAG_THRESHOLD:5,PINCH_END_DELAY:200},VIEWPORT:{MIN_SCALE:.05,MAX_SCALE:50,FRICTION:.95},SPRITES:{PLACEHOLDER_COLOR:16777215,TEXTURE_SIZES:[128,256,512,1024,1536,2048]},IMAGES:{DEFAULT_SIZE:128,DEFAULT_EXT:"avif",HIGH_RES_SIZE:2048,HIGH_RES_EXT:"jpg"}},{setTitle:D,setIcon:w,resetAppBar:E}=Pe(),{enableSearch:A,setSearchResultsCallback:L,disableSearch:l}=Me(),{showError:Z,showLoading:Y,closePopup:$}=ke(),O=P(null),y=ce(null),r=ce(null),N=P([]),h=new Map,_=new Map;let M=null,J=null,G=0,z=0,C=null;function Q(e){J=e}function R(){C.clear();const e=r.value.getVisibleBounds(),t=document.documentElement.classList.contains("dark")?u.GRID.COLOR_DARK:u.GRID.COLOR_LIGHT,n=(c,p,T)=>{C.lineStyle(T/r.value.scale.x,t,p);const j=Math.floor(e.x/c)*c,i=Math.ceil((e.x+e.width)/c)*c,s=Math.floor(e.y/c)*c,X=Math.ceil((e.y+e.height)/c)*c;for(let m=j;m<i;m+=c)C.moveTo(m,s),C.lineTo(m,X);for(let m=s;m<X;m+=c)C.moveTo(j,m),C.lineTo(i,m)},a=Math.min(1,r.value.scale.x*4);a>.1&&n(u.GRID.MINOR_LINE_SPACING,a,u.GRID.ALPHA_MINOR);const d=Math.min(1,r.value.scale.x*2);d>.05&&n(u.GRID.MAJOR_LINE_SPACING,d,u.GRID.ALPHA_MAJOR)}function K(e,o=u.IMAGES.DEFAULT_SIZE,t=u.IMAGES.DEFAULT_EXT){return`/gallery/${e}/${e}-${o}.${t}`}async function ee(){try{Y("gallery2d.loading"),await F("https://cdn.jsdelivr.net/npm/pixi.js@7.4.3/dist/pixi.min.js"),await F("https://cdn.jsdelivr.net/npm/pixi-viewport@5.1.0/dist/viewport.min.js"),await te(),ne(),window.addEventListener("resize",V),x(),S(),await U(),await b(),r.value.fit(),r.value.moveCenter(G/2,z/2),R(),y.value.ticker.add(H),$()}catch(e){console.error("Failed to initialize gallery:",e),Z("gallery2d.error",e.message,!0)}}function F(e){return new Promise((o,t)=>{if(document.querySelector(`script[src="${e}"]`)){o();return}const n=document.createElement("script");n.src=e,n.async=!0,n.onload=()=>o(),n.onerror=()=>t(new Error(`Failed to load script: ${e}`)),document.head.appendChild(n)})}async function te(){const o=document.documentElement.classList.contains("dark")?u.BACKGROUND.COLOR_DARK:u.BACKGROUND.COLOR_LIGHT;y.value=new window.PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:o,antialias:!0,powerPreference:"high-performance",resolution:Math.max(1,Math.min(window.devicePixelRatio||1,2)),autoDensity:!0}),O.value&&O.value.appendChild(y.value.view),y.value.view.style.touchAction="none",y.value.renderer.events.moveOnAll=!0}function ne(){M=new MutationObserver(()=>{if(y.value&&y.value.renderer){const e=document.documentElement.classList.contains("dark");y.value.renderer.background.color=e?u.BACKGROUND.COLOR_DARK:u.BACKGROUND.COLOR_LIGHT,R()}}),M.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}async function f(){if(window.PIXI&&window.PIXI.Assets){const e=Array.from(h.keys()).map(o=>{const[t,n]=o.split("-");return K(t,n)});e.length>0&&await window.PIXI.Assets.unload(e)}h.clear(),_.clear(),y.value&&y.value.destroy(!0,{children:!0,texture:!1,baseTexture:!1}),M&&(M.disconnect(),M=null),window.removeEventListener("resize",V)}async function v(e){if(e.length===0){_.forEach(a=>{a.alpha=1});return}const o=new Map;e.forEach(a=>{o.set(a.imageName,a.similarity)});const t=Math.min(...o.values()),n=Math.max(...o.values());_.forEach((a,d)=>{a.alpha=(o.get(d)??0-t)/(n-t)})}function x(){r.value=new window.PIXI.Viewport({screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:G,worldHeight:z,events:y.value.renderer.events}),y.value.stage.addChild(r.value);let e=!1,o=null,t=null,n=null;const a=new Map;let d=0,c=null,p=!1,T=!1;r.value.eventMode="static",r.value.hitArea=y.value.screen,r.value.on("pointerdown",i=>{if(i.pointerType==="touch")if(a.set(i.pointerId,{x:i.global.x,y:i.global.y}),a.size===2){p=!0,e=!1,n=null,r.value.plugins.pause("decelerate");const s=Array.from(a.values());d=Math.hypot(s[0].x-s[1].x,s[0].y-s[1].y),c={x:(s[0].x+s[1].x)/2,y:(s[0].y+s[1].y)/2}}else a.size===1&&!p&&(t={x:i.global.x,y:i.global.y},o={x:i.global.x,y:i.global.y},e=!1,n={x:i.global.x,y:i.global.y});else i.originalEvent.button===0&&(t={x:i.global.x,y:i.global.y},o={x:i.global.x,y:i.global.y},e=!1,n={x:i.global.x,y:i.global.y},r.value.plugins.pause("decelerate"))}),r.value.on("pointermove",i=>{if(i.pointerType==="touch"){if(!a.has(i.pointerId))return;if(a.set(i.pointerId,{x:i.global.x,y:i.global.y}),a.size===2&&p){const s=Array.from(a.values()),X=Math.hypot(s[0].x-s[1].x,s[0].y-s[1].y),m={x:(s[0].x+s[1].x)/2,y:(s[0].y+s[1].y)/2};if(d>0&&X>0&&c){const we=m.x-c.x,xe=m.y-c.y;r.value.x+=we,r.value.y+=xe;const Ie=X/d,ie=r.value.toWorld(m),Se=r.value.scale.x,Ee=Math.max(u.VIEWPORT.MIN_SCALE,Math.min(u.VIEWPORT.MAX_SCALE,Se*Ie));r.value.scale.set(Ee);const se=r.value.toScreen(ie.x,ie.y);r.value.x+=m.x-se.x,r.value.y+=m.y-se.y,R()}d=X,c=m}else a.size===1&&!p&&!T&&(!e&&t&&Math.hypot(i.global.x-t.x,i.global.y-t.y)>u.INTERACTION.DRAG_THRESHOLD&&(e=!0,n=null),e&&o&&(r.value.x+=i.global.x-o.x,r.value.y+=i.global.y-o.y,R()),o={x:i.global.x,y:i.global.y})}else if(o&&t){const s={x:i.global.x,y:i.global.y};e||Math.hypot(s.x-t.x,s.y-t.y)>u.INTERACTION.DRAG_THRESHOLD&&(e=!0,n=null),e&&(r.value.x+=s.x-o.x,r.value.y+=s.y-o.y,R()),o=s}});const j=i=>{if(i.pointerType==="touch"){if(!e&&!p&&!T&&n&&a.size===1&&g(n),a.delete(i.pointerId),a.size<2&&p&&(p=!1,d=0,c=null,T=!0,setTimeout(()=>{T=!1},u.INTERACTION.PINCH_END_DELAY),a.size===1)){const s=a.values().next().value;s&&(t={x:s.x,y:s.y},o={x:s.x,y:s.y},e=!1,n={x:s.x,y:s.y})}a.size<1&&(e&&r.value.plugins.resume("decelerate"),e=!1,o=null,t=null,n=null,T=!1)}else i.originalEvent.button===0&&(!e&&n&&g(n),e&&r.value.plugins.resume("decelerate"),e=!1,o=null,t=null,n=null)};r.value.on("pointerup",j),r.value.on("pointerupoutside",j),r.value.on("pointercancel",j),r.value.wheel().decelerate({friction:u.VIEWPORT.FRICTION}),r.value.clampZoom({minScale:u.VIEWPORT.MIN_SCALE,maxScale:u.VIEWPORT.MAX_SCALE})}function g(e){const o=e.x,t=e.y;let n=null;for(const a of _.values())if(a.getBounds().contains(o,t)){n=a;break}if(n)if(n&&n.name){const a=K(n.name,u.IMAGES.HIGH_RES_SIZE,u.IMAGES.HIGH_RES_EXT);window.open(a,"_blank")}else console.warn("Click handler called with invalid sprite:",n)}function S(){C=new window.PIXI.Graphics,r.value.addChild(C),r.value.on("moved",R),r.value.on("zoomed",R),R()}async function b(){const e=new window.PIXI.Graphics().beginFill(u.SPRITES.PLACEHOLDER_COLOR).drawRect(0,0,128,128).endFill(),o=y.value.renderer.generateTexture(e);N.value.forEach(t=>{const n=new window.PIXI.Sprite(o);n.anchor.set(.5),n.width=u.BASE_SPRITE_SIZE,n.height=u.BASE_SPRITE_SIZE,n.x=t.x,n.y=t.y,n.eventMode="none",n.name=t.name,r.value.addChild(n),_.set(t.name,n)})}async function U(){const o=await(await fetch(u.COORDS_URL)).json(),t=Object.entries(o).map(([p,T])=>({name:p,x:T[0],y:T[1]})),n=Math.min(...t.map(p=>p.x)),a=Math.max(...t.map(p=>p.x)),d=Math.min(...t.map(p=>p.y)),c=Math.max(...t.map(p=>p.y));G=a-n,z=c-d,N.value=t.map(p=>({...p,x:p.x-n,y:p.y-d}))}function H(){if(!r.value)return;const e=r.value.getVisibleBounds(),o=r.value.scale.x;_.forEach((t,n)=>{const a=t.x>e.x-t.width/2&&t.x<e.x+e.width+t.width/2&&t.y>e.y-t.height/2&&t.y<e.y+e.height+t.height/2;if(t.visible=a,a){const d=u.BASE_SPRITE_SIZE*o,c=u.SPRITES.TEXTURE_SIZES,p=c.find(T=>T>=d)||c[c.length-1];W(n,p)}})}async function W(e,o){const t=`${e}-${o}`;if(h.has(t)){const a=_.get(e);a&&a.texture!==h.get(t)&&(a.texture=h.get(t));return}const n=K(e,o);try{const a=await window.PIXI.Assets.load(n);h.set(t,a);const d=_.get(e);d&&(d.texture=a)}catch(a){console.warn(`Could not load texture: ${n}`,a),h.set(t,null)}}function V(){!y.value||!r.value||(y.value.renderer.resize(window.innerWidth,window.innerHeight),r.value.resize(window.innerWidth,window.innerHeight,G,z))}return ye(()=>{D("gallery2d.title"),w("pi pi-hashtag"),A(),L(v),ee().then(()=>J?.(r.value,u,G,R))}),he(()=>{E(),l(),f()}),(e,o)=>(k(),q("div",Ue,[ve(Fe,{registerOnReady:Q}),B("div",{ref_key:"canvasContainer",ref:O,class:"gallery-canvas"},null,512)]))}}),Ze=ge(We,[["__scopeId","data-v-c81e892d"]]);export{Ze as default};
