import{s as U,a as Z}from"./index-DBYKmIrQ.js";import{d as J,u as K,a as Q,b as X,o as Y,c as ee,r as d,w as te,e as k,f as v,g as w,h as q,i as ae,j as u,k as N,s as re,t as p,n as oe,l as se,_ as ne}from"./main-D_frdEHf.js";import{s as le}from"./index-BXeIhO2t.js";function ce(_,i){let c;return(...f)=>{clearTimeout(c),c=setTimeout(()=>_(...f),i)}}const ie={class:"gallery-container"},de={class:"columns-controls","aria-label":"Layout controls"},ue={for:"cols"},me={class:"column-display"},ge={key:0,class:"loading-container"},pe="/gallery/images.txt",b="calc((100cqw - (var(--cols) - 1) * var(--gap)) / var(--cols))",fe=J({__name:"GalleryView",setup(_){let i=null,c=null;const{enableSearch:f,setSearchResultsCallback:V,resetSearch:z}=K(),{t:S}=Q(),{setTitle:A,setIcon:L,resetAppBar:P}=X();Y(()=>{A("gallery.title"),L("pi pi-images"),f(),V(async e=>{if(e.length===0)T(x.value);else{const t=e.map(a=>a.imageName);T(t)}}),H()}),ee(()=>{P(),z(),i&&i.disconnect(),c&&document.removeEventListener("visibilitychange",c)});const O=[128,256,512,1024,1536,2048],m=d(!0),g=d(""),l=d(4),h=d(10),C=d([]),x=d([]),E=localStorage.getItem("gridColumns");if(E){const e=parseInt(E,10);e>=1&&e<=13&&(l.value=e)}else l.value=Math.floor($());te(l,e=>{const t=document.querySelector("#grid");t&&(t.style.setProperty("--cols",e.toString()),localStorage.setItem("gridColumns",e.toString()))},{immediate:!0});const B=()=>new Promise(e=>requestAnimationFrame(e)),G=e=>new Promise(t=>setTimeout(t,e));function $(){let e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0);return e=Math.min(e,1800),e/384}function I(){let e=Math.floor($()*3);return e=Math.min(e,13),e=Math.max(e,5),e}function y(e,t){return O.map(a=>`/gallery/${e}/${e}-${a}.${t} ${a}w`).join(", ")}async function j(e,t=1e4){try{const a=G(t).then(()=>{const r=new Error("decode() timeout");throw r.name="TimeoutError",r});await Promise.race([e.decode(),a])}catch{}}function F(e){const t=document.createElement("figure");t.className="gallery-card",t.dataset.imageName=e;const a=document.createElement("a");a.href=`/gallery/${e}/${e}-2048.jpg`,a.target="_blank",a.rel="noopener",a.setAttribute("aria-label",`View high resolution image: ${e}`);const r=document.createElement("picture"),n=document.createElement("source");n.type="image/avif",n.sizes=b,n.dataset.srcset=y(e,"avif");const s=document.createElement("source");s.type="image/webp",s.sizes=b,s.dataset.srcset=y(e,"webp");const o=document.createElement("img");return o.alt=`Photo: ${e}`,o.decoding="async",o.loading="lazy",o.fetchPriority="low",o.className="img-lqip gallery-image",o.sizes=b,o.src=`/gallery/${e}/${e}-lqip.jpg`,o.dataset.srcset=y(e,"jpg"),o.dataset.name=e,r.append(n,s,o),a.appendChild(r),t.appendChild(a),t.style.contentVisibility="auto",{figure:t,img:o}}async function M(e){if(e.dataset.hydrated==="1")return;const a=e.parentElement.querySelectorAll("source");e.fetchPriority="high",e.loading="eager",a.forEach(r=>{r.dataset.srcset&&!r.srcset&&(r.srcset=r.dataset.srcset)}),e.dataset.srcset&&!e.srcset&&(e.srcset=e.dataset.srcset),await B(),await j(e),e.classList.remove("img-lqip"),e.classList.add("img-loaded"),e.dataset.hydrated="1"}function R(){if(!("IntersectionObserver"in window))return null;const e=new IntersectionObserver(t=>{for(const a of t){const r=a.target;a.isIntersecting&&(M(r).catch(()=>{r.classList.remove("img-lqip"),r.classList.add("img-error"),r.alt=`Failed to load image: ${r.dataset.name||""}`}),e.unobserve(r))}},{rootMargin:"200px 0px",threshold:.01});return e}function D(){if("ResizeObserver"in window){const e=ce(()=>{const t=I();h.value=t,l.value>t&&(l.value=t)},250);i=new ResizeObserver(e),i.observe(document.body),h.value=I()}}async function W(){const e=new AbortController,t=setTimeout(()=>e.abort(),1e4);try{const a=await fetch(pe,{cache:"no-store",signal:e.signal});if(!a.ok)throw new Error(`HTTP ${a.status}: ${a.statusText}`);const n=(await a.text()).split(/\r?\n/).map(s=>s.trim()).filter(Boolean).filter(s=>/^[a-zA-Z0-9_-]+$/.test(s));if(!n.length)throw new Error("No valid images found");return n}finally{clearTimeout(t)}}function T(e){const t=document.querySelector("#grid");if(!t)return;const a=Array.from(t.querySelectorAll(".gallery-card")),r=new Map;a.forEach(s=>{const o=s.dataset.imageName;o&&r.set(o,s)}),a.forEach(s=>s.remove());const n=document.createDocumentFragment();e.forEach(s=>{const o=r.get(s);o&&n.appendChild(o)}),t.appendChild(n),C.value=[...e]}async function H(){const e=document.querySelector("#grid");if(!e){console.error("Grid element not found"),g.value=S("gallery.gridNotFound"),m.value=!1;return}try{const t=await W();x.value=[...t],C.value=[...t];const a=document.createDocumentFragment(),r=R();for(const n of t){const{figure:s,img:o}=F(n);a.appendChild(s),r?r.observe(o):M(o).catch(()=>{})}e.appendChild(a),m.value=!1,D(),c=()=>{e.querySelectorAll("img").forEach(s=>{const o=s;o.fetchPriority=document.hidden?"low":o.dataset.hydrated==="1"?"auto":"high"})},document.addEventListener("visibilitychange",c),console.log(`Gallery initialized with ${t.length} images`)}catch(t){console.error("Gallery initialization failed:",t);const a=t;g.value=S("gallery.error",{error:a.message}),m.value=!1}}return(e,t)=>{const a=le,r=re,n=U,s=Z;return v(),k("div",ie,[w(r,{class:"gallery-controls"},{content:N(()=>[u("div",de,[u("label",ue,p(e.$t("gallery.columns")),1),w(a,{id:"cols",modelValue:l.value,"onUpdate:modelValue":t[0]||(t[0]=o=>l.value=o),min:1,max:h.value,step:1,class:"column-slider"},null,8,["modelValue","max"]),u("span",me,p(l.value),1)])]),_:1}),m.value?(v(),k("div",ge,[w(n,{style:{width:"50px",height:"50px"},strokeWidth:"8"}),u("h4",null,p(e.$t("gallery.loading")),1)])):q("",!0),g.value?(v(),ae(s,{key:1,severity:"error",closable:!1},{default:N(()=>[se(p(g.value),1)]),_:1})):q("",!0),u("div",{id:"grid",class:"gallery-grid",style:oe({"--cols":l.value}),"aria-live":"polite"},null,4)])}}}),we=ne(fe,[["__scopeId","data-v-36d2342d"]]);export{we as default};
