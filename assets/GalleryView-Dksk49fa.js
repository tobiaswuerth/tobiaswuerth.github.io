import{d as x,r as g,c as V,o as C,a as N,b as w,e as f,f as n,_ as z,u as B,g as j,h as q,i as b,w as A,s as E,F as G,j as L,n as T,t as S,k as F,l as P}from"./main-VvUlaYAo.js";import{s as W}from"./index-CL_OwbAv.js";const D={class:"gallery-card"},H=["href"],U=["data-srcset","sizes"],R=["data-srcset","sizes"],Z=["data-srcset","sizes","src","alt"],J=x({__name:"GalleryImage",props:{imageName:{},cols:{}},setup(p){const a=p,e=g();let s=null;function m(o,i){return[128,256,512,1024,1536,2048].map(h=>`/gallery/${o}/${o}-${h}.${i} ${h}w`).join(", ")}const d=V(()=>`calc((100vw - 32px - (${a.cols-1} * 8px)) / ${a.cols})`);async function v(){try{if(!e.value){console.error("No image element to hydrate");return}if(e.value.dataset.hydrated==="1"){console.warn("Image already hydrated",e.value.src);return}e.value.dataset.hydrated="1",e.value.fetchPriority="high",e.value.loading="eager",e.value.parentElement.querySelectorAll("source").forEach(i=>i.srcset=i.dataset.srcset),e.value.srcset=e.value.dataset.srcset,e.value.decode().finally(()=>{e.value.classList.remove("img-lqip")})}catch(o){console.error("Error hydrating image",o)}}function _(){if(!("IntersectionObserver"in window)){console.warn("IntersectionObserver not supported"),v().catch(console.error);return}s=new IntersectionObserver(o=>{if(!e.value){console.error("No image element to observe");return}if(o.length===0){console.warn("No intersection entries");return}o[0].isIntersecting&&v().catch(()=>{console.warn("Failed to hydrate image",e.value.src),e.value.classList.remove("img-lqip"),e.value.alt=`Failed to load image: ${e.value.dataset.name||""}`}).finally(y)},{rootMargin:"200px 0px",threshold:.01}),s.observe(e.value)}function y(){s&&(s.disconnect(),s=null)}return C(()=>{_()}),N(()=>{y()}),(o,i)=>(f(),w("figure",D,[n("a",{href:`/gallery/${a.imageName}/${a.imageName}-2048.jpg`,target:"_blank",rel:"noopener"},[n("picture",null,[n("source",{type:"image/avif","data-srcset":m(a.imageName,"avif"),sizes:d.value},null,8,U),n("source",{type:"image/webp","data-srcset":m(a.imageName,"webp"),sizes:d.value},null,8,R),n("img",{ref_key:"eImg",ref:e,type:"image/jpeg","data-srcset":m(a.imageName,"jpg"),sizes:d.value,src:`/gallery/${a.imageName}/${a.imageName}-lqip.jpg`,loading:"lazy",decoding:"async",fetchpriority:"low",alt:a.imageName,class:"img-lqip gallery-image"},null,8,Z)])],8,H)]))}}),K=z(J,[["__scopeId","data-v-e72a4bc6"]]);function Q(p,a){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>p(...s),a)}}const X={class:"gallery-container"},Y={class:"columns-controls","aria-label":"Layout controls"},ee={for:"cols"},ae={class:"column-display"},te=x({__name:"GalleryView",setup(p){const a=g(4),e=g(10),s=g([]),m=g([]),{enableSearch:d,setSearchResultsCallback:v,disableSearch:_}=B(),{setTitle:y,setIcon:o,resetAppBar:i}=j(),{showLoading:I,closePopup:h}=q();C(()=>{y("gallery.title"),o("pi pi-images"),d(),v(async c=>{if(c.length===0){s.value=m.value;return}s.value=c.map(l=>l.imageName)}),O(),M()}),N(()=>{i(),_()});const $=Q(k,200);function k(...c){const l=c[0],r=Array.isArray(l)?l[0]:l;document.querySelector("#grid").style.setProperty("--cols",r.toString()),localStorage.setItem("gridColumns",r.toString())}function M(){const l=Math.min(Math.max(document.documentElement.clientWidth,window.innerWidth),1800)/384,r=Math.max(Math.min(Math.floor(l*3),13),5);e.value=r;let t;const u=localStorage.getItem("gridColumns");u?(t=parseInt(u),t>r&&(t=r)):t=Math.floor(l),a.value=t,$(t)}async function O(){I("gallery.loading");const r=(await(await fetch("/gallery/images.txt",{cache:"no-store"})).text()).split(/\r?\n/).map(t=>t.trim()).filter(Boolean).filter(t=>/^[a-zA-Z0-9_-]+$/.test(t));m.value=[...r],s.value=[...r],h()}return(c,l)=>{const r=W,t=E;return f(),w("div",X,[b(t,{class:"gallery-controls"},{content:A(()=>[n("div",Y,[n("label",ee,S(c.$t("gallery.columns")),1),b(r,{id:"cols",modelValue:a.value,"onUpdate:modelValue":[l[0]||(l[0]=u=>a.value=u),F($)],min:1,max:e.value,step:1,class:"column-slider"},null,8,["modelValue","max","onUpdate:modelValue"]),n("span",ae,S(a.value),1)])]),_:1}),n("div",{id:"grid",class:"gallery-grid",style:T({"--cols":a.value}),"aria-live":"polite"},[(f(!0),w(G,null,L(s.value,u=>(f(),P(K,{key:u,"image-name":u,cols:a.value},null,8,["image-name","cols"]))),128))],4)])}}}),le=z(te,[["__scopeId","data-v-52e6a05f"]]);export{le as default};
