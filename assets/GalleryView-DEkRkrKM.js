import{d as k,r as d,c as M,o as z,a as V,b as h,e as p,f as c,_ as O,u as A,g as F,h as W,i as I,w as D,s as H,F as S,j as x,n as C,t as N,k as U,l as R}from"./main-DGXOq_dG.js";import{s as Z}from"./index-Cc2s5aO-.js";const J={class:"gallery-card"},K=["href"],Q=["data-srcset","sizes"],X=["data-srcset","sizes"],Y=["data-srcset","sizes","src","alt"],ee=k({__name:"GalleryImage",props:{imageName:{},cols:{}},setup(y){const t=y,e=d();let n=null;function g(r,m){return[128,256,512,1024,1536,2048].map(_=>`/gallery/${r}/${r}-${_}.${m} ${_}w`).join(", ")}const u=M(()=>`calc((100vw - 32px - (${t.cols-1} * 8px)) / ${t.cols})`);async function v(){try{if(!e.value){console.error("No image element to hydrate");return}if(e.value.dataset.hydrated==="1"){console.warn("Image already hydrated",e.value.src);return}e.value.dataset.hydrated="1",e.value.fetchPriority="high",e.value.loading="eager",e.value.parentElement.querySelectorAll("source").forEach(m=>m.srcset=m.dataset.srcset),e.value.srcset=e.value.dataset.srcset,e.value.decode().finally(()=>{e.value.classList.remove("img-lqip")})}catch(r){console.error("Error hydrating image",r)}}function w(){if(!("IntersectionObserver"in window)){console.warn("IntersectionObserver not supported"),v().catch(console.error);return}n=new IntersectionObserver(r=>{if(!e.value){console.error("No image element to observe");return}if(r.length===0){console.warn("No intersection entries");return}r[0].isIntersecting&&v().catch(()=>{console.warn("Failed to hydrate image",e.value.src),e.value.classList.remove("img-lqip"),e.value.alt=`Failed to load image: ${e.value.dataset.name||""}`}).finally(f)},{rootMargin:"200px 0px",threshold:.01}),n.observe(e.value)}function f(){n&&(n.disconnect(),n=null)}return z(()=>{w()}),V(()=>{f()}),(r,m)=>(p(),h("figure",J,[c("a",{href:`/gallery/${t.imageName}/${t.imageName}-2048.jpg`,target:"_blank",rel:"noopener"},[c("picture",null,[c("source",{type:"image/avif","data-srcset":g(t.imageName,"avif"),sizes:u.value},null,8,Q),c("source",{type:"image/webp","data-srcset":g(t.imageName,"webp"),sizes:u.value},null,8,X),c("img",{ref_key:"eImg",ref:e,type:"image/jpeg","data-srcset":g(t.imageName,"jpg"),sizes:u.value,src:`/gallery/${t.imageName}/${t.imageName}-lqip.jpg`,loading:"lazy",decoding:"async",fetchpriority:"low",alt:t.imageName,class:"img-lqip gallery-image"},null,8,Y)])],8,K)]))}}),ae=O(ee,[["__scopeId","data-v-e72a4bc6"]]);function te(y,t){let e;return(...n)=>{clearTimeout(e),e=setTimeout(()=>y(...n),t)}}const se={class:"gallery-container"},le={class:"columns-controls","aria-label":"Layout controls"},oe={for:"cols"},ne={class:"slider-container"},re={class:"slider-ticks"},ie={class:"column-display"},ce=k({__name:"GalleryView",setup(y){const t=d(3),e=d(5),n=d([]),g=d([]),u=d(30),v=d(30),w=M(()=>{const l=e.value*10,o=[];for(let a=2;a<=e.value-1;a++){const P=(a*10-10)/(l-10)*100;o.push(P)}return o}),{enableSearch:f,setSearchResultsCallback:r,disableSearch:m}=A(),{setTitle:$,setIcon:_,resetAppBar:B}=F(),{showLoading:j,closePopup:q}=W();z(()=>{$("gallery.title"),_("pi pi-images"),f(),r(async s=>{if(s.length===0){n.value=g.value;return}n.value=s.map(l=>l.imageName)}),L(),G()}),V(()=>{B(),m()});function b(s){v.value=s*10,u.value=s*10,t.value=s,document.querySelector("#grid").style.setProperty("--cols",s.toString()),localStorage.setItem("gridColumns",s.toString())}const T=te(E,200);function E(...s){const l=s[0],o=l>v.value?1:-1;let a=Math.round(l/10);a===t.value&&(a+=o),a=Math.max(1,Math.min(e.value,a)),b(a)}function G(){const l=Math.min(Math.max(document.documentElement.clientWidth,window.innerWidth),1800)/384,o=Math.max(Math.min(Math.floor(l*3),13),5);e.value=o;let a;const i=localStorage.getItem("gridColumns");i?(a=parseInt(i),a>o&&(a=o)):a=Math.floor(l),b(a)}async function L(){j("gallery.loading");const o=(await(await fetch("/gallery/images.txt",{cache:"no-store"})).text()).split(/\r?\n/).map(a=>a.trim()).filter(Boolean).filter(a=>/^[a-zA-Z0-9_-]+$/.test(a));g.value=[...o],n.value=[...o],q()}return(s,l)=>{const o=Z,a=H;return p(),h("div",se,[I(a,{class:"gallery-controls"},{content:D(()=>[c("div",le,[c("label",oe,N(s.$t("gallery.columns")),1),c("div",ne,[I(o,{id:"cols",modelValue:u.value,"onUpdate:modelValue":[l[0]||(l[0]=i=>u.value=i),U(T)],min:10,max:e.value*10,step:1,class:"column-slider"},null,8,["modelValue","max","onUpdate:modelValue"]),c("div",re,[(p(!0),h(S,null,x(w.value,i=>(p(),h("div",{key:i,class:"tick",style:C({left:i+"%"})},null,4))),128))])]),c("span",ie,N(t.value),1)])]),_:1}),c("div",{id:"grid",class:"gallery-grid",style:C({"--cols":t.value}),"aria-live":"polite"},[(p(!0),h(S,null,x(n.value,i=>(p(),R(ae,{key:i,"image-name":i,cols:t.value},null,8,["image-name","cols"]))),128))],4)])}}}),de=O(ce,[["__scopeId","data-v-6b693919"]]);export{de as default};
