import{B as Ae,b as ee,e as N,m as ie,f as z,p as Te,d as ve,r as M,o as ge,a as me,F as _e,l as le,q as se,i as we,t as de,v as pe,x as Ce,w as be,T as Oe,y as Pe,_ as xe,g as Me,u as ke,h as Le,z as fe}from"./main-CLg0SgfB.js";var De=`
    .p-progressspinner {
        position: relative;
        margin: 0 auto;
        width: 100px;
        height: 100px;
        display: inline-block;
    }

    .p-progressspinner::before {
        content: '';
        display: block;
        padding-top: 100%;
    }

    .p-progressspinner-spin {
        height: 100%;
        transform-origin: center center;
        width: 100%;
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: auto;
        animation: p-progressspinner-rotate 2s linear infinite;
    }

    .p-progressspinner-circle {
        stroke-dasharray: 89, 200;
        stroke-dashoffset: 0;
        stroke: dt('progressspinner.colorOne');
        animation:
            p-progressspinner-dash 1.5s ease-in-out infinite,
            p-progressspinner-color 6s ease-in-out infinite;
        stroke-linecap: round;
    }

    @keyframes p-progressspinner-rotate {
        100% {
            transform: rotate(360deg);
        }
    }
    @keyframes p-progressspinner-dash {
        0% {
            stroke-dasharray: 1, 200;
            stroke-dashoffset: 0;
        }
        50% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -35px;
        }
        100% {
            stroke-dasharray: 89, 200;
            stroke-dashoffset: -124px;
        }
    }
    @keyframes p-progressspinner-color {
        100%,
        0% {
            stroke: dt('progressspinner.color.one');
        }
        40% {
            stroke: dt('progressspinner.color.two');
        }
        66% {
            stroke: dt('progressspinner.color.three');
        }
        80%,
        90% {
            stroke: dt('progressspinner.color.four');
        }
    }
`,Ne={root:"p-progressspinner",spin:"p-progressspinner-spin",circle:"p-progressspinner-circle"},Ge=Ae.extend({name:"progressspinner",style:De,classes:Ne}),He={name:"BaseProgressSpinner",extends:Te,props:{strokeWidth:{type:String,default:"2"},fill:{type:String,default:"none"},animationDuration:{type:String,default:"2s"}},style:Ge,provide:function(){return{$pcProgressSpinner:this,$parentInstance:this}}},Ie={name:"ProgressSpinner",extends:He,inheritAttrs:!1,computed:{svgStyle:function(){return{"animation-duration":this.animationDuration}}}},Ve=["fill","stroke-width"];function Xe(I,u,b,v,E,R){return N(),ee("div",ie({class:I.cx("root"),role:"progressbar"},I.ptmi("root")),[(N(),ee("svg",ie({class:I.cx("spin"),viewBox:"25 25 50 50",style:R.svgStyle},I.ptm("spin")),[z("circle",ie({class:I.cx("circle"),cx:"50",cy:"50",r:"20",fill:I.fill,"stroke-width":I.strokeWidth,strokeMiterlimit:"10"},I.ptm("circle")),null,16,Ve)],16))],16)}Ie.render=Xe;const Be="/2d-tutorial.webm",$e="/2d-tutorial-alt.png",Fe={key:1},ye=1500,he="gallery2d.tutorial_viewed",ze=ve({__name:"Gallery2DTutorial",props:{registerOnReady:{type:Function}},setup(I){const u=I,b=M(null),v=M(null),E=M(null),R=M(!0),G=M(!1);let s=null,K=null,te=null,U=null,H=null,q=null;const ne=M(!1),k=M(!1);let c=!1;function r(){try{return!!localStorage.getItem(he)}catch{return!1}}function Y(){try{localStorage.setItem(he,"1")}catch{}}function O(p,y,w,g){if(!p||!y||!w||!g){console.warn("Tutorial not starting: missing required parameters"),console.debug({viewport_:p,config_:y,worldWidth_:w,drawGrid_:g});return}console.log("2D tutorial ready"),s=p,K=y,te=w,U=g,ne.value=!0,r()||A()}function C(){console.warn("Tutorial video: error loading/playing source"),R.value=!0}function V(){R.value=!1}function W(){return new Promise(p=>{if(v.value&&v.value.readyState>=2){p();return}v.value?v.value.addEventListener("canplay",()=>p(),{once:!0}):p()})}function L(){return new Promise(p=>{if(E.value&&E.value.complete){p();return}E.value?E.value.addEventListener("load",()=>p(),{once:!0}):p()})}async function A(){if(!b.value||!v.value){console.warn("Tutorial not starting: tutorial container or tutorial video not initialized"),console.debug({tutorialContainer:b.value,tutorialVideo:v.value});return}if(c=!1,k.value=!0,H={x:s.x,y:s.y,scale:s.scale.x},q=s.eventMode,s.eventMode="none",s.plugins.pause("decelerate"),s.plugins.pause("drag"),s.plugins.pause("pinch"),s.plugins.pause("wheel"),G.value=!1,R.value?E.value&&(E.value.src="/2d-tutorial-alt.png",await L(),G.value=!0):(await W(),G.value=!0),!R.value)try{v.value.currentTime=0,await v.value.play()}catch(p){console.warn("Tutorial video cannot be played:",p),R.value=!0,E.value&&(E.value.src="/2d-tutorial-alt.png",await L(),G.value=!0)}await ae(!1),!c&&(await re(!1),!c&&(await re(!0),!c&&(await ae(!0),!c&&(Y(),J()))))}function m(){c=!0,J(),Y()}function J(){if(!b.value||!v.value){console.error("Tutorial not stopping: tutorial container or tutorial video not initialized");return}if(k.value=!1,v.value.pause(),H&&s)try{s.x=H.x,s.y=H.y,s.scale.set(H.scale)}catch{}q!==null&&s?s.eventMode=q:s.eventMode="static",s.plugins.resume("decelerate"),s.plugins.resume("drag"),s.plugins.resume("pinch"),s.plugins.resume("wheel"),U()}function ae(p=!1){return new Promise(y=>{const w=s.scale.x,g=p?w/10:w*10,S=p?Math.max(K.VIEWPORT.MIN_SCALE,g):Math.min(K.VIEWPORT.MAX_SCALE,g),T={x:window.innerWidth/2,y:window.innerHeight/2},X=s.toWorld(T.x,T.y),B=S-w;if(Math.abs(B)<1e-6){y();return}const j=ye/1e3,$=Math.abs(B)/j;let D=performance.now();const Z=e=>{if(c){y();return}const a=(e-D)/1e3;D=e;const t=Math.sign(B);let n=s.scale.x+t*$*a;(t>0&&n>=S||t<0&&n<=S)&&(n=S),s.scale.set(n);const o=s.toScreen(X.x,X.y);if(s.x+=T.x-o.x,s.y+=T.y-o.y,U(),n===S){y();return}requestAnimationFrame(Z)};requestAnimationFrame(Z)})}function re(p=!1){return new Promise(y=>{const w=te/4,g=s.x,S=p?g-w:g+w,T=S-g;if(Math.abs(T)<1e-6){y();return}const X=ye/1e3,B=Math.abs(T)/X;let j=performance.now();const $=D=>{if(c){y();return}const Z=(D-j)/1e3;j=D;const e=Math.sign(T);let a=s.x+e*B*Z;if((e>0&&a>=S||e<0&&a<=S)&&(a=S),s.x=a,U(),a===S){y();return}requestAnimationFrame($)};requestAnimationFrame($)})}return ge(()=>{if(!("ontouchstart"in window)&&navigator.maxTouchPoints<1){console.log("Skipping 2D tutorial: no touch support detected");return}u.registerOnReady(O)}),me(()=>{c=!0,J()}),(p,y)=>{const w=Ie,g=Ce;return N(),ee(_e,null,[z("div",{ref_key:"tutorialContainer",ref:b,class:pe(["tutorial",{hide:!k.value}])},[G.value?se("",!0):(N(),le(w,{key:0,class:"spinner"})),z("h2",null,de(p.$t("gallery2d.tutorial")),1),z("video",{ref_key:"tutorialVideo",ref:v,muted:"",preload:"metadata",onError:C,onCanplay:V,class:pe({hide:R.value})},[...y[0]||(y[0]=[z("source",{src:Be,type:"video/webm"},null,-1)])],34),R.value?(N(),ee("div",Fe,[z("img",{ref_key:"tutorialImage",ref:E,src:$e,alt:"2D Tutorial"},null,512)])):se("",!0),we(g,{class:"tutorial-skip",onClick:m,severity:"contrast",rounded:""},{default:be(()=>[Pe(de(p.$t("gallery2d.tutorial_skip")),1)]),_:1})],2),(N(),le(Oe,{to:"body"},[ne.value&&!k.value?(N(),le(g,{key:0,icon:"pi pi-question-circle",onClick:A,raised:"",text:"",rounded:"",severity:"primary",variant:"outlined","aria-label":p.$t("gallery2d.tutorial"),class:"tutorial-button"},null,8,["aria-label"])):se("",!0)]))],64)}}}),Ue=xe(ze,[["__scopeId","data-v-508ba487"]]),We={class:"gallery-2d-container"},je=ve({__name:"Gallery2DView",setup(I){const u={COORDS_URL:"/gallery2d.json",BASE_SPRITE_SIZE:128,BACKGROUND:{COLOR_LIGHT:15132379,COLOR_DARK:1710618},GRID:{COLOR_LIGHT:13290186,COLOR_DARK:3355443,ALPHA_MAJOR:.5,ALPHA_MINOR:.25,MAJOR_LINE_SPACING:100,MINOR_LINE_SPACING:20},INTERACTION:{DRAG_THRESHOLD:5,PINCH_END_DELAY:200},VIEWPORT:{MIN_SCALE:.05,MAX_SCALE:50,FRICTION:.95},SPRITES:{PLACEHOLDER_COLOR:16777215,TEXTURE_SIZES:[128,256,512,1024,1536,2048]},IMAGES:{DEFAULT_SIZE:128,DEFAULT_EXT:"avif",HIGH_RES_SIZE:2048,HIGH_RES_EXT:"jpg"}};function b(e,a=u.IMAGES.DEFAULT_SIZE,t=u.IMAGES.DEFAULT_EXT){return`/gallery/${e}/${e}-${a}.${t}`}function v(e){return new Promise((a,t)=>{if(document.querySelector(`script[src="${e}"]`)){a();return}const n=document.createElement("script");n.src=e,n.async=!0,n.onload=()=>a(),n.onerror=()=>t(new Error(`Failed to load script: ${e}`)),document.head.appendChild(n)})}async function E(){await v("https://cdn.jsdelivr.net/npm/pixi.js@7.4.3/dist/pixi.min.js"),await v("https://cdn.jsdelivr.net/npm/pixi-viewport@5.1.0/dist/viewport.min.js")}const{setTitle:R,setIcon:G,resetAppBar:s}=Me(),{enableSearch:K,setSearchResultsCallback:te,disableSearch:U}=ke(),{showError:H,showLoading:q,closePopup:ne}=Le(),k=M(null),c=fe(null),r=fe(null),Y=M([]),O=new Map,C=new Map;let V=0,W=0,L=null,A=null,m=null;async function J(){try{q("gallery2d.loading"),await E(),await p(),await y(),w(),g(),S(),c.value.ticker.add(B),ne()}catch(e){console.error("Failed to initialize gallery:",e),H("gallery2d.error",e.message,!0)}}async function ae(){if(window.PIXI&&window.PIXI.Assets){const e=Array.from(O.keys()).map(a=>{const[t,n]=a.split("-");return b(t,n)});e.length>0&&await window.PIXI.Assets.unload(e)}O.clear(),C.clear(),c.value&&c.value.destroy(!0,{children:!0,texture:!1,baseTexture:!1}),L&&(L.disconnect(),L=null),window.removeEventListener("resize",$)}async function re(e){if(e.length===0){C.forEach(o=>{o.alpha=1});return}const a=new Map;e.forEach(o=>{a.set(o.imageName,o.similarity)});const t=Math.min(...a.values()),n=Math.max(...a.values());C.forEach((o,h)=>{o.alpha=(a.get(h)??0-t)/(n-t)})}async function p(){const a=document.documentElement.classList.contains("dark")?u.BACKGROUND.COLOR_DARK:u.BACKGROUND.COLOR_LIGHT;c.value=new window.PIXI.Application({width:window.innerWidth,height:window.innerHeight,backgroundColor:a,antialias:!0,powerPreference:"high-performance",resolution:Math.max(1,Math.min(window.devicePixelRatio||1,2)),autoDensity:!0}),k.value&&(k.value.appendChild(c.value.view),c.value.view.style.touchAction="none"),c.value.renderer.events.moveOnAll=!0,L=new MutationObserver(()=>{if(c.value&&c.value.renderer){const t=document.documentElement.classList.contains("dark");c.value.renderer.background.color=t?u.BACKGROUND.COLOR_DARK:u.BACKGROUND.COLOR_LIGHT,m&&m()}}),L.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]}),window.addEventListener("resize",$)}async function y(){const a=await(await fetch(u.COORDS_URL)).json(),t=Object.entries(a).map(([d,f])=>({name:d,x:f[0],y:f[1]})),n=Math.min(...t.map(d=>d.x)),o=Math.max(...t.map(d=>d.x)),h=Math.min(...t.map(d=>d.y)),x=Math.max(...t.map(d=>d.y));V=o-n,W=x-h,Y.value=t.map(d=>({...d,x:d.x-n,y:d.y-h}))}function w(){r.value=new window.PIXI.Viewport({screenWidth:window.innerWidth,screenHeight:window.innerHeight,worldWidth:V,worldHeight:W,events:c.value.renderer.events}),c.value.stage.addChild(r.value);let e=!1,a=null,t=null,n=null;const o=new Map;let h=0,x=null,d=!1,f=!1;r.value.eventMode="static",r.value.hitArea=c.value.screen,r.value.on("pointerdown",l=>{if(l.pointerType==="touch")if(o.set(l.pointerId,{x:l.global.x,y:l.global.y}),o.size===2){d=!0,e=!1,n=null,r.value.plugins.pause("decelerate");const i=Array.from(o.values());h=Math.hypot(i[0].x-i[1].x,i[0].y-i[1].y),x={x:(i[0].x+i[1].x)/2,y:(i[0].y+i[1].y)/2}}else o.size===1&&!d&&(t={x:l.global.x,y:l.global.y},a={x:l.global.x,y:l.global.y},e=!1,n={x:l.global.x,y:l.global.y});else l.originalEvent.button===0&&(t={x:l.global.x,y:l.global.y},a={x:l.global.x,y:l.global.y},e=!1,n={x:l.global.x,y:l.global.y},r.value.plugins.pause("decelerate"))}),r.value.on("pointermove",l=>{if(l.pointerType==="touch"){if(!o.has(l.pointerId))return;if(o.set(l.pointerId,{x:l.global.x,y:l.global.y}),o.size===2&&d){const i=Array.from(o.values()),F=Math.hypot(i[0].x-i[1].x,i[0].y-i[1].y),P={x:(i[0].x+i[1].x)/2,y:(i[0].y+i[1].y)/2};if(h>0&&F>0&&x){const oe=P.x-x.x,_=P.y-x.y;r.value.x+=oe,r.value.y+=_;const Se=F/h,ue=r.value.toWorld(P),Ee=r.value.scale.x,Re=Math.max(u.VIEWPORT.MIN_SCALE,Math.min(u.VIEWPORT.MAX_SCALE,Ee*Se));r.value.scale.set(Re);const ce=r.value.toScreen(ue.x,ue.y);r.value.x+=P.x-ce.x,r.value.y+=P.y-ce.y,m&&m()}h=F,x=P}else o.size===1&&!d&&!f&&(!e&&t&&Math.hypot(l.global.x-t.x,l.global.y-t.y)>u.INTERACTION.DRAG_THRESHOLD&&(e=!0,n=null),e&&a&&(r.value.x+=l.global.x-a.x,r.value.y+=l.global.y-a.y,m&&m()),a={x:l.global.x,y:l.global.y})}else if(a&&t){const i={x:l.global.x,y:l.global.y};e||Math.hypot(i.x-t.x,i.y-t.y)>u.INTERACTION.DRAG_THRESHOLD&&(e=!0,n=null),e&&(r.value.x+=i.x-a.x,r.value.y+=i.y-a.y,m&&m()),a=i}});const Q=l=>{if(l.pointerType==="touch"){if(!e&&!d&&!f&&n&&o.size===1){const i=X(n.x,n.y);i&&T(i)}if(o.delete(l.pointerId),o.size<2&&d&&(d=!1,h=0,x=null,f=!0,setTimeout(()=>{f=!1},u.INTERACTION.PINCH_END_DELAY),o.size===1)){const i=o.values().next().value;i&&(t={x:i.x,y:i.y},a={x:i.x,y:i.y},e=!1,n={x:i.x,y:i.y})}o.size<1&&(e&&r.value.plugins.resume("decelerate"),e=!1,a=null,t=null,n=null,f=!1)}else if(l.originalEvent.button===0){if(!e&&n){const i=X(n.x,n.y);i&&T(i)}e&&r.value.plugins.resume("decelerate"),e=!1,a=null,t=null,n=null}};r.value.on("pointerup",Q),r.value.on("pointerupoutside",Q),r.value.on("pointercancel",Q),r.value.wheel().decelerate({friction:u.VIEWPORT.FRICTION}),r.value.clampZoom({minScale:u.VIEWPORT.MIN_SCALE,maxScale:u.VIEWPORT.MAX_SCALE}),r.value.fit(),r.value.moveCenter(V/2,W/2)}function g(){A=new window.PIXI.Graphics,r.value.addChild(A),m=()=>{A.clear();const e=r.value.getVisibleBounds(),a=u.GRID.MAJOR_LINE_SPACING,t=u.GRID.MINOR_LINE_SPACING,n=Math.min(1,r.value.scale.x*2),o=Math.min(1,r.value.scale.x*4),x=document.documentElement.classList.contains("dark")?u.GRID.COLOR_DARK:u.GRID.COLOR_LIGHT,d=(f,Q,l)=>{A.lineStyle(l/r.value.scale.x,x,Q);const i=Math.floor(e.x/f)*f,F=Math.ceil((e.x+e.width)/f)*f,P=Math.floor(e.y/f)*f,oe=Math.ceil((e.y+e.height)/f)*f;for(let _=i;_<F;_+=f)A.moveTo(_,P),A.lineTo(_,oe);for(let _=P;_<oe;_+=f)A.moveTo(i,_),A.lineTo(F,_)};o>.1&&d(t,o,u.GRID.ALPHA_MINOR),n>.05&&d(a,n,u.GRID.ALPHA_MAJOR)},r.value.on("moved",m),m()}function S(){const e=new window.PIXI.Graphics().beginFill(u.SPRITES.PLACEHOLDER_COLOR).drawRect(0,0,128,128).endFill(),a=c.value.renderer.generateTexture(e);Y.value.forEach(t=>{const n=new window.PIXI.Sprite(a);n.anchor.set(.5),n.width=u.BASE_SPRITE_SIZE,n.height=u.BASE_SPRITE_SIZE,n.x=t.x,n.y=t.y,n.eventMode="none",n.name=t.name,r.value.addChild(n),C.set(t.name,n)})}function T(e){if(e&&e.name){const a=b(e.name,u.IMAGES.HIGH_RES_SIZE,u.IMAGES.HIGH_RES_EXT);window.open(a,"_blank")}else console.warn("Click handler called with invalid sprite:",e)}function X(e,a){for(const t of C.values())if(t.getBounds().contains(e,a))return t;return null}function B(){if(!r.value)return;const e=r.value.getVisibleBounds(),a=r.value.scale.x;C.forEach((t,n)=>{const o=t.x>e.x-t.width/2&&t.x<e.x+e.width+t.width/2&&t.y>e.y-t.height/2&&t.y<e.y+e.height+t.height/2;if(t.visible=o,o){const h=u.BASE_SPRITE_SIZE*a,x=u.SPRITES.TEXTURE_SIZES,d=x.find(f=>f>=h)||x[x.length-1];j(n,d)}})}async function j(e,a){const t=`${e}-${a}`;if(O.has(t)){const o=C.get(e);o&&o.texture!==O.get(t)&&(o.texture=O.get(t));return}const n=b(e,a);try{const o=await window.PIXI.Assets.load(n);O.set(t,o);const h=C.get(e);h&&(h.texture=o)}catch(o){console.warn(`Could not load texture: ${n}`,o),O.set(t,null)}}function $(){!c.value||!r.value||(c.value.renderer.resize(window.innerWidth,window.innerHeight),r.value.resize(window.innerWidth,window.innerHeight,V,W))}let D=null;function Z(e){D=e}return ge(async()=>{R("gallery2d.title"),G("pi pi-hashtag"),await J(),K(),te(re),D?.(r.value,u,V,m)}),me(()=>{s(),U(),ae()}),(e,a)=>(N(),ee("div",We,[we(Ue,{registerOnReady:Z}),z("div",{ref_key:"canvasContainer",ref:k,class:"gallery-canvas"},null,512)]))}}),Ke=xe(je,[["__scopeId","data-v-b3dfe71b"]]);export{Ke as default};
